---
title: 强连通分量
date: 2023-12-24 22:04:06
tags:
  - 算法
  - 图论
  - 强连通分量
  - Tarjan
categories:
  - [算法, 图论, 连通性相关]
---

# 强连通分量

> 参考：
> 
> - <https://oi-wiki.org/graph/scc>
> - <https://github.com/atcoder/ac-library>

## Tarjan [洛谷B3609](https://www.luogu.com.cn/problem/B3609) 强连通分量

{% contentbox "cpp" type:code %}

```cpp
#include <bits/stdc++.h>

struct Edge {
    int v;
};
using AdjList = std::vector<std::vector<Edge>>;

std::pair<int, std::vector<int>> scc(const AdjList& G) {
    const int N = G.size();
    std::vector<int> dfn(N, -1), low(N), scc_ids(N), stk;
    stk.reserve(N);
    int dfn_cnt = 0, scc_cnt = 0;
    auto dfs = [&](auto& dfs, int u) -> void {
        low[u] = dfn[u] = dfn_cnt++;
        stk.push_back(u);
        for (auto&& e : G[u]) {
            if (dfn[e.v] == -1) {
                dfs(dfs, e.v);
                low[u] = std::min(low[u], low[e.v]);
            } else {
                low[u] = std::min(low[u], dfn[e.v]);
            }
        }
        if (dfn[u] == low[u]) {
            for (;;) {
                int v = stk.back();
                stk.pop_back();
                dfn[v] = N;
                scc_ids[v] = scc_cnt;
                if (v == u) break;
            }
            ++scc_cnt;
        }
    };
    for (int u = 0; u < G.size(); ++u)
        if (dfn[u] == -1) dfs(dfs, u);
    return {scc_cnt, scc_ids};
}

using namespace std;
int main() {
    ios::sync_with_stdio(false), cin.tie(0);
    int N, M;
    cin >> N >> M;
    AdjList G(N);
    for (int i = 0; i < M; ++i) {
        int u, v;
        cin >> u >> v;
        --u, --v;
        G[u].emplace_back(Edge{v});
    }
    auto [scc_cnt, scc_ids] = scc(G);
    cout << scc_cnt << "\n";
    vector<vector<int>> sccs(scc_cnt);
    for (int u = 0; u < N; ++u) sccs[scc_ids[u]].push_back(u);
    vector<bool> vi(scc_cnt);
    for (auto&& scc_id : scc_ids) {
        if (vi[scc_id]) continue;
        vi[scc_id] = true;
        for (int v : sccs[scc_id]) cout << v + 1 << ' ';
        cout << "\n";
    }
    return 0;
}
```

{% endcontentbox %}
